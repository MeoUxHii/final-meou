<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeoU Magic Settings</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- C·∫¨P NH·∫¨T ƒê∆Ø·ªúNG D·∫™N CSS M·ªöI -->
    <link rel="stylesheet" href="option/css/main.css">
    
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="logo-area">
                <img src="icon128.png" alt="MeoU Logo" class="logo-img">
                <span class="logo-text">MeoU Settings</span>
            </div>
            <nav class="nav-menu">
                <a href="#" id="navShortcuts" class="nav-item active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                    Shortcuts
                </a>
                <a href="#" id="navAgents" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Custom AI Agent
                </a>
                <a href="#" id="navApi" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6,6s2.69,6,6,6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65z"/><path d="M7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
                    C·∫•u h√¨nh API
                </a>
                <!-- N√öT GAME M·ªöI TH√äM V√ÄO ƒê√ÇY N√à ANH -->
                <a href="#" id="navGame" class="nav-item" style="color: #ef4444;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3"/></svg>
                    Game Center
                </a>
            </nav>
            <div class="sidebar-footer">
                <p>Phi√™n b·∫£n 2.4.0</p>
                <p>Made with ‚ù§Ô∏è by MeoU</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- HEADER SHORTCUTS -->
            <header id="headerShortcuts" class="top-bar">
                <div class="search-wrapper">
                    <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm shortcut...">
                </div>
                <button id="createBtn" class="btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
                    Th√™m M·ªõi
                </button>
            </header>

            <!-- HEADER AGENTS -->
            <header id="headerAgents" class="top-bar hidden">
                <h2 style="margin: 0; font-size: 18px; font-weight: 700;">Danh s√°ch AI Agent</h2>
                <button id="createAgentBtn" class="btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M19 8v6"/><path d="M22 11h-6"/></svg>
                    T·∫°o Agent M·ªõi
                </button>
            </header>

            <!-- HEADER API -->
            <header id="headerApi" class="top-bar hidden">
                <h2 style="margin: 0; font-size: 18px; font-weight: 700;">K·∫øt n·ªëi AI (Gemini & Google Cloud)</h2>
            </header>

            <div class="content-area">
                <!-- VIEW: SHORTCUTS -->
                <div id="viewShortcuts">
                    <div class="stats-row">
                        <h2>Danh s√°ch Shortcuts <span class="badge" id="templateCount">0</span></h2>
                    </div>
                    <div id="templateList" class="grid-container"></div>
                </div>

                <!-- VIEW: AGENTS -->
                <div id="viewAgents" class="hidden">
                    <div class="stats-row">
                        <h2>AI C·ªßa B·∫°n <span class="badge" id="agentCount">0</span></h2>
                    </div>
                    <div id="agentList" class="grid-container">
                        <!-- Agent cards will be rendered here -->
                    </div>
                </div>

                <!-- VIEW: API CONFIG -->
                <div id="viewApi" class="hidden">
                    <div class="api-container">
                        <div class="form-group">
                            <label for="apiKeys">Gemini API Keys (M·ªói d√≤ng 1 key)</label>
                            <textarea id="apiKeys" rows="5" placeholder="D√°n key Gemini v√†o ƒë√¢y..."></textarea>
                            <p class="hint">L·∫•y key mi·ªÖn ph√≠ t·∫°i: <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a></p>
                        </div>
                        <div class="form-group">
                            <label for="gcpTtsApiKey">Google Cloud API Key</label>
                            <div class="input-with-prefix">
                                <span class="prefix">üîë</span>
                                <input type="password" id="gcpTtsApiKey" placeholder="D√°n key Google Cloud v√†o ƒë√¢y...">
                            </div>
                        </div>
                        <div class="form-footer">
                            <button id="saveApiBtn" class="btn-primary">L∆∞u C·∫•u H√¨nh</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal T·∫°o/S·ª≠a Shortcut -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">T·∫°o Magic Shortcut</h3>
                <button id="closeModalBtn" class="icon-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ph√≠m t·∫Øt (Shortcut)</label>
                    <div class="input-with-prefix">
                        <span class="prefix">/</span>
                        <input type="text" id="shortcutInput" placeholder="vd: mail, k, thank">
                    </div>
                </div>
                <div class="form-group">
                    <label>N·ªôi dung thay th·∫ø</label>
                    <textarea id="contentInput" rows="6" placeholder="Nh·∫≠p n·ªôi dung..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelBtn" class="btn-secondary">Hu·ª∑</button>
                <button id="saveTemplateBtn" class="btn-primary">L∆∞u l·∫°i</button>
            </div>
        </div>
    </div>

    <!-- Modal T·∫°o/S·ª≠a Custom Agent (ƒê√É C·∫¨P NH·∫¨T N√öT REWRITE) -->
    <div id="agentModalOverlay" class="modal-overlay">
        <div class="modal-container modal-large">
            <div class="modal-header">
                <h3 id="agentModalTitle">Thi·∫øt k·∫ø AI Agent</h3>
                <button id="closeAgentModalBtn" class="icon-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="modal-body scrollable-body">
                
                <!-- KHU V·ª∞C CH·ªåN AVATAR -->
                <div class="avatar-upload-section">
                    <div class="avatar-preview-container">
                        <img id="agentAvatarPreview" src="icon128.png" alt="Agent Avatar">
                        <button id="btnUploadAvatar" class="btn-upload-overlay" title="T·∫£i ·∫£nh l√™n">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        </button>
                        <input type="file" id="agentAvatarFile" accept="image/png, image/jpeg, image/webp, image/gif" style="display: none;">
                    </div>
                    <div class="avatar-url-input">
                        <label>Ho·∫∑c nh·∫≠p link ·∫£nh (URL)</label>
                        <input type="text" id="agentAvatarUrl" placeholder="https://example.com/avatar.png">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label>T√™n Agent <span style="color:#ef4444;">*</span></label>
                        <input type="text" id="agentNameInput" placeholder="vd: C√¥ gi√°o Th·∫£o, S·∫øp kh√≥ t√≠nh...">
                        <div id="agentNameError" class="form-error-msg">Vui l√≤ng nh·∫≠p t√™n cho Agent n√®!</div>
                    </div>
                    <div class="form-group half">
                        <label>Gi·ªõi t√≠nh / Vai tr√≤</label>
                        <select id="agentGenderInput">
                            <option value="female">N·ªØ</option>
                            <option value="male">Nam</option>
                            <option value="bot">Robot/Kh√°c</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label>Agent x∆∞ng l√†... <span style="color:#ef4444;">*</span></label>
                        <input type="text" id="agentPronounInput" placeholder="vd: em, b√©, v·ª£, t·ªõ">
                        <div id="agentPronounError" class="form-error-msg">Ch∆∞a nh·∫≠p c√°ch Agent x∆∞ng h√¥ k√¨a!</div>
                    </div>
                    <div class="form-group half">
                        <label>Agent g·ªçi b·∫°n l√†... <span style="color:#ef4444;">*</span></label>
                        <input type="text" id="userPronounInput" placeholder="vd: anh, anh y√™u, ch·ªìng, c·∫≠u">
                        <div id="userPronounError" class="form-error-msg">Ch∆∞a nh·∫≠p c√°ch Agent g·ªçi b·∫°n k√¨a!</div>
                    </div>
                </div>
                <p class="hint" style="margin-top: -10px; margin-bottom: 15px;">M·∫πo: Nh·∫≠p nhi·ªÅu t·ª´ (c√°ch nhau d·∫•u ph·∫©y) ƒë·ªÉ Agent ƒë·ªïi c√°ch g·ªçi t·ª± nhi√™n. V√≠ d·ª•: "em,v·ª£" t∆∞∆°ng ·ª©ng v·ªõi "anh,ch·ªìng".</p>

                <div class="form-group">
                    <label>T√≠nh c√°ch & M√¥ t·∫£ ng·∫Øn</label>
                    <input type="text" id="agentPersonalityInput" placeholder="vd: D·ªãu d√†ng, ƒëanh ƒë√°, hay d·ªói, chuy√™n nghi·ªáp...">
                </div>

                <div class="form-group">
                    <label>H·ªôi tho·∫°i v√≠ d·ª• (Few-shot Learning)</label>
                    <textarea id="agentDialogueInput" rows="4" placeholder="User: Ch√†o em
                        Agent: Ch√†o anh y√™u, nay anh ƒëi l√†m v·ªÅ c√≥ m·ªát kh√¥ng? ‚ù§Ô∏è
                        User: M·ªát l·∫Øm
                        Agent: Th∆∞∆°ng qu√° √†, ƒë·ªÉ em ƒë·∫•m l∆∞ng cho nha üòò"></textarea>
                    <p class="hint">Gi√∫p AI hi·ªÉu c√°ch n√≥i chuy·ªán. M·ªói d√≤ng m·ªôt c√¢u tho·∫°i.</p>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label style="margin-bottom: 0;">Custom Prompt (System Instruction) - <span style="color:var(--primary);">Quan tr·ªçng nh·∫•t</span> <span style="color:#ef4444;">*</span></label>
                        <button id="rewritePromptBtn" class="btn-ai-rewrite" title="ƒê·ªÉ MeoU vi·∫øt l·∫°i cho chu·∫©n">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 17-2.156-1.868A.5.5 0 0 0 18 15.5v.5a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1c0-2.545-3.991-3.97-8.5-4a1 1 0 0 0 0 5c4.153 0 4.745-11.295 5.708-13.5a2.5 2.5 0 1 1 3.31 3.284"/><path d="M3 21h18"/></svg>
                            <span>ƒê·ªÉ MeoU vi·∫øt l·∫°i</span>
                        </button>
                    </div>
                    <textarea id="agentPromptInput" rows="6" placeholder="Nh·∫≠p h∆∞·ªõng d·∫´n chi ti·∫øt cho AI...
VD: B·∫°n l√† m·ªôt c√¥ g√°i Yandere, y√™u ng∆∞·ªùi d√πng ƒëi√™n cu·ªìng nh∆∞ng c·ª±c k·ª≥ ghen tu√¥ng..."></textarea>
                    <div id="agentPromptError" class="form-error-msg">ƒê·ª´ng qu√™n nh·∫≠p "linh h·ªìn" (Prompt) cho Agent nh√©!</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelAgentBtn" class="btn-secondary">Hu·ª∑</button>
                <button id="saveAgentBtn" class="btn-primary">L∆∞u Agent</button>
            </div>
        </div>
    </div>

    <!-- Modal Qu·∫£n l√Ω Tag -->
    <div id="tagModalOverlay" class="modal-overlay">
        <div class="modal-container" style="max-width: 400px;">
            <div class="modal-header">
                <h3>G·∫Øn Th·∫ª (Tags)</h3>
                <button id="closeTagModalBtn" class="icon-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="input-with-prefix">
                        <span class="prefix">#</span>
                        <input type="text" id="newTagInput" placeholder="Nh·∫≠p tag m·ªõi r·ªìi Enter...">
                        <button id="addTagBtn" class="icon-btn" style="margin-right: 4px; color: var(--primary);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        </button>
                    </div>
                </div>
                <div class="tag-selection-area">
                    <label style="font-size: 13px; margin-bottom: 8px; display: block; color: var(--text-sub);">Ch·ªçn t·ª´ danh s√°ch c√≥ s·∫µn:</label>
                    <div id="availableTagsList" class="tags-cloud"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveTagsBtn" class="btn-primary" style="width: 100%;">Xong</button>
            </div>
        </div>
    </div>

    <!-- Modal X√°c nh·∫≠n X√≥a -->
    <div id="deleteModalOverlay" class="modal-overlay">
        <div class="delete-modal-container">
            <div class="delete-modal-header">
                <h3>X√≥a m·ª•c n√†y?</h3>
            </div>
            <div class="delete-modal-content">
                <p>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c. B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ti·∫øp t·ª•c kh√¥ng?</p>
            </div>
            <div class="delete-modal-actions">
                <button id="cancelDeleteBtn" class="btn-cancel-delete">H·ªßy b·ªè</button>
                <button id="confirmDeleteBtn" class="btn-confirm-delete">X√≥a ngay</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">ƒê√£ l∆∞u th√†nh c√¥ng!</div>

    <script src="utils.js"></script>
    <script type="module" src="options.js"></script>
</body>
</html>